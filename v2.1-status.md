# WeGo Traffic Source v2.1 Development Status

## Repository State

- Working branch: `v2.1`
- Main (default) branch: `master`
- The current master is tagged 2.0.2
- We have not merged the 2.1 branch yet

## Codebase rules

- No heredoc syntax
- No javascrpt forEach, use for..of instead
- Javscript should be in external files and loaded as ES modules
- Tab indent, WordPress coding style rules

## Next task: implement auto updates from the github repository

- see the github-auto-updates.md file
- âœ… Phase 1 & 2 complete: `includes/class-plugin-updater.php` created
  - Hooks `pre_set_site_transient_update_plugins` for update checking
  - Hooks `plugins_api` for plugin details popup
  - Caches GitHub API responses in transients (12 hour expiry)
  - Handles GitHub zipball directory renaming on update
  - Graceful failure with brief cache on API errors
- **To test:** Create a GitHub release with a version > 2.1.1, then check for updates in WP admin

## Future Best Practices Fixes

- **CSV filename header:** export_csv() sets Content-Disposition: attachment; filename=... without quoting/encoding. If filename contains spaces or non-ASCII, some clients may mis-handle it.
Recommendation: wrap filename in double quotes or use RFC5987 encoding (filename*). Example: header('Content-Disposition: attachment; filename="' . $filename . '"'); or more robust encoding for UTF-8.

- **Document click listeners (performance):** Currently each configured event type attaches its own `document.click` handler. For performance and clarity prefer a single delegated click handler that iterates configured selectors on each click. This reduces the number of listeners and simplifies event matching.

- **Guarding get_plugin_data():**: get_plugin_data() is an admin helper; calling it when not available may fail. If you need plugin headers at runtime, require the admin include or guard with function_exists().

- **Duplicate DB queries in `add_admin_filter_dropdown()`:**:  the same query pattern is repeated for each meta key. Consider a helper to reduce duplication.

- **Potential PHP notices:**  few places assume array keys exist (e.g., checking $event_type['slug'])

## Future Polish (Optional)

- Reporting dashboard with charts/graphs
- Data cleanup:
  - "Delete All Tracking Data" button on Event Types settings page
  - Deletes posts for known CPTs only (not wildcard `wego_*`)
  - Deletes only plugin-specific options by name

